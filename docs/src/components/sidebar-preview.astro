---
import type { AutoSidebarGroup, SidebarItem } from '../../../packages/starlight/schemas/sidebar';
import SidebarSublist from '../../../packages/starlight/components/SidebarSublist.astro';
import type { SidebarEntry } from '../../../packages/starlight/utils/navigation';

interface Props {
	config: SidebarConfig;
}

type SidebarConfig = Exclude<SidebarItem, AutoSidebarGroup>[];

const { config } = Astro.props;

function makeEntries(items: SidebarConfig): SidebarEntry[] {
	return items.map((item) => {
		if ('link' in item) {
			return {
				type: 'link',
				label: item.label,
				href: item.link,
				isCurrent: false,
				badge: item.badge,
				attrs: item.attrs ?? {},
			};
		}

		return {
			type: 'group',
			label: item.label,
			entries: makeEntries(item.items as SidebarConfig),
			collapsed: item.collapsed,
		};
	});
}
---

<div class="sidebar-preview not-content">
	<SidebarSublist sublist={makeEntries(config)} />
</div>

<style>
	.sidebar-preview {
		background-color: var(--sl-color-bg-sidebar);
		border: 1px solid var(--sl-color-gray-5);
		padding: 1rem var(--sl-sidebar-pad-x);
		max-width: var(--sl-sidebar-width);
	}

	:global(.sidebar-preview-external-link::after) {
		background-color: var(--sl-color-gray-2);
		content: '';
		display: inline-block;
		margin-left: 0.5rem;
		height: 1rem;
		vertical-align: text-top;
		width: 1rem;
		-webkit-mask-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTE4IDEwLjgyYTEgMSAwIDAgMC0xIDFWMTlhMSAxIDAgMCAxLTEgMUg1YTEgMSAwIDAgMS0xLTFWOGExIDEgMCAwIDEgMS0xaDcuMThhMSAxIDAgMCAwIDAtMkg1YTMgMyAwIDAgMC0zIDN2MTFhMyAzIDAgMCAwIDMgM2gxMWEzIDMgMCAwIDAgMy0zdi03LjE4YTEgMSAwIDAgMC0xLTFabTMuOTItOC4yYTEgMSAwIDAgMC0uNTQtLjU0QTEgMSAwIDAgMCAyMSAyaC02YTEgMSAwIDAgMCAwIDJoMy41OUw4LjI5IDE0LjI5YTEgMSAwIDAgMCAwIDEuNDIgMSAxIDAgMCAwIDEuNDIgMEwyMCA1LjQxVjlhMSAxIDAgMCAwIDIgMFYzYTEgMSAwIDAgMC0uMDgtLjM4WiIvPjwvc3ZnPg==');
		mask-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTE4IDEwLjgyYTEgMSAwIDAgMC0xIDFWMTlhMSAxIDAgMCAxLTEgMUg1YTEgMSAwIDAgMS0xLTFWOGExIDEgMCAwIDEgMS0xaDcuMThhMSAxIDAgMCAwIDAtMkg1YTMgMyAwIDAgMC0zIDN2MTFhMyAzIDAgMCAwIDMgM2gxMWEzIDMgMCAwIDAgMy0zdi03LjE4YTEgMSAwIDAgMC0xLTFabTMuOTItOC4yYTEgMSAwIDAgMC0uNTQtLjU0QTEgMSAwIDAgMCAyMSAyaC02YTEgMSAwIDAgMCAwIDJoMy41OUw4LjI5IDE0LjI5YTEgMSAwIDAgMCAwIDEuNDIgMSAxIDAgMCAwIDEuNDIgMEwyMCA1LjQxVjlhMSAxIDAgMCAwIDIgMFYzYTEgMSAwIDAgMC0uMDgtLjM4WiIvPjwvc3ZnPg==');
		-webkit-mask-repeat: no-repeat;
		mask-repeat: no-repeat;
	}

	:global(.sidebar-preview-external-link:is(:hover, :focus)::after) {
		background-color: var(--sl-color-white);
	}
</style>
